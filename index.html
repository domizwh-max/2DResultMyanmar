<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Market Status Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .top-number {
            text-align: center;
            font-size: 100px;
            font-family: 'Roboto', sans-serif;
            font-weight: 900;
            margin: 20px 0;
        }
        
        .labels {
            display: flex;
            justify-content: center;
            gap: 50px;
            margin-bottom: 10px;
        }
        
        .label {
            font-size: 20px; /* Same size as timeslot cards */
            font-family: 'Roboto', sans-serif;
            font-weight: 900;
            text-align: center;
        }
        
        .data-container {
            display: flex;
            justify-content: center;
            gap: 50px;
            margin-bottom: 30px;
        }
        
        .data-item {
            font-size: 20px; /* Same size as timeslot cards */
            text-align: center;
        }
        
        .timeslot-card {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .timeslot-label {
            text-align: center;
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 15px;
        }
        
        .timeslot-data {
            display: flex;
            justify-content: center;
            gap: 30px;
        }
        
        .timeslot-column {
            text-align: center;
        }
        
        .timeslot-header {
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .timeslot-value {
            font-size: 20px;
        }
        
        .holiday-section {
            margin-top: 30px;
        }
        
        .holiday-button {
            display: block;
            width: 200px;
            padding: 15px;
            background-color: #007bff;
            color: white;
            text-align: center;
            border: none;
            border-radius: 5px;
            font-size: 18px;
            cursor: pointer;
            margin: 20px auto;
        }
        
        .holiday-table {
            display: none;
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        .wThStyle {
            background-color: #343a40;
            color: white;
            padding: 10px;
            text-align: left;
        }
        
        .wTdStyle {
            padding: 10px;
            border-bottom: 1px solid #dee2e6;
        }
        
        .market-status {
            text-align: center;
            padding: 10px;
            margin: 20px 0;
            border-radius: 5px;
            font-weight: bold;
            font-size: 20px;
        }
        
        .open {
            background-color: #d4edda;
            color: #155724;
        }
        
        .closed {
            background-color: #f8d7da;
            color: #721c24;
        }
        
        .break {
            background-color: #fff3cd;
            color: #856404;
        }
        
        .fade-in {
            opacity: 1;
            transition: opacity 0.5s ease-in;
        }
        
        .fade-out {
            opacity: 0;
            transition: opacity 0.5s ease-out;
        }
        
        /* Modern Internet Box Styles */
        .feature-card {
            background-color: #b1e1e3;
            box-shadow: none;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }
        
        table {
            border-collapse: collapse;
            width: 100%;
            height: auto;
        }
        
        .modIntS {
            font-size: 20px;
        }
        
        .modIntV {
            font-size: 20px;
        }
        
        .blockValStyle {
            font-size: 20px;
        }
        
        .blockLucky {
            font-size: 20px;
            text-align: center;
        }
        
        .blockTime {
            font-size: 20px;
            text-align: center;
            font-weight: bold;
        }
        
        .blockSetStyle {
            font-weight: bold;
            text-align: center;
        }
        
        /* Popup styles */
        .popup {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 1000;
        }
        
        .popup-content {
            background-color: white;
            margin: 10% auto;
            padding: 20px;
            border-radius: 10px;
            width: 80%;
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .close {
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        
        .row {
            display: flex;
            margin-bottom: 10px;
        }
        
        .col-md-12 {
            width: 100%;
        }
        
        .col-md-4 {
            width: 33.33%;
        }
        
        .col-md-2 {
            width: 16.66%;
        }
        
        .pb5 {
            padding-bottom: 5px;
        }
        
        .col-12 {
            width: 100%;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 style="text-align: center;">Market Status Dashboard</h1>
        
        <div class="market-status" id="marketStatus">
            Market Status: Checking...
        </div>
        
        <!-- Top 2-digit number -->
        <div class="top-number" id="topNumber">00</div>
        
        <!-- Timestamp with checkmarks -->
        <div style="text-align: center; font-size: 16px; margin-bottom: 20px;">
            <span id="timestamp">01/01/2025 at 09:30:00</span>
            <span>✓✓</span>
        </div>
        
        <!-- SET and VALUE labels -->
        <div class="labels">
            <div class="label">SET</div>
            <div class="label">VALUE</div>
        </div>
        
        <!-- Data containers -->
        <div class="data-container">
            <div class="data-item">
                <div id="setData" class="value text-white mb-0 me-2 lh-1 stock-info">1,291.46</div>
            </div>
            <div class="data-item">
                <div id="valueData" class="d-block quote-market-cost border-0">33,202.91</div>
            </div>
        </div>
        
        <!-- Timeslot Cards -->
        <div class="timeslot-card">
            <div class="timeslot-label">12:01 PM</div>
            <div class="timeslot-data">
                <div class="timeslot-column">
                    <div class="timeslot-header">SET</div>
                    <div class="timeslot-value" id="setFixData1">1,261.23</div>
                </div>
                <div class="timeslot-column">
                    <div class="timeslot-header">VALUE</div>
                    <div class="timeslot-value" id="valueFixData1">13,522.14</div>
                </div>
                <div class="timeslot-column">
                    <div class="timeslot-header">2D</div>
                    <div class="timeslot-value" id="twodFixData1">32</div>
                </div>
            </div>
        </div>
        
        <div class="timeslot-card">
            <div class="timeslot-label">4:30 PM</div>
            <div class="timeslot-data">
                <div class="timeslot-column">
                    <div class="timeslot-header">SET</div>
                    <div class="timeslot-value" id="setFixData2">1,252.71</div>
                </div>
                <div class="timeslot-column">
                    <div class="timeslot-header">VALUE</div>
                    <div class="timeslot-value" id="valueFixData2">23,180.98</div>
                </div>
                <div class="timeslot-column">
                    <div class="timeslot-header">2D</div>
                    <div class="timeslot-value" id="twodFixData2">10</div>
                </div>
            </div>
        </div>
        
        <!-- Modern Internet Boxes -->
        <div class="row" style="margin-top: 10px;">
            <div class="col-md-2"></div>
            <div class="col-md-4 col-12">
                <div class="feature-card" style="background-color: #b1e1e3; box-shadow: none;">
                    <table border="0" style="border-collapse: collapse; width: 100%; height: auto;">
                        <tbody>
                            <tr>
                                <td style="width: 33%; font-size: 20px;" rowspan="2" class="modIntS">9:30 AM</td>
                                <td style="width: 33%;" class="modIntS">Modern</td>
                                <td style="width: 33%;" class="modIntS">Internet</td>
                            </tr>
                            <tr>
                                <td style="width: 33%;" class="modIntV" id="modernData1">--</td>
                                <td style="width: 33%;" class="modIntV" id="internetData1">--</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="col-md-4 col-12">
                <div class="feature-card" style="background-color: #b1e1e3; box-shadow: none;">
                    <table border="0" style="border-collapse: collapse; width: 100%; height: auto;">
                        <tbody>
                            <tr>
                                <td style="width: 33%; font-size: 20px;" rowspan="2" class="modIntS">2:00 PM</td>
                                <td style="width: 33%;" class="modIntS">Modern</td>
                                <td style="width: 33%;" class="modIntS">Internet</td>
                            </tr>
                            <tr>
                                <td style="width: 33%;" class="modIntV" id="modernData2">--</td>
                                <td style="width: 33%;" class="modIntV" id="internetData2">--</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="col-md-2"></div>
        </div>

        <!-- Holiday Section -->
        <div class="holiday-section">
            <button class="holiday-button" onclick="openHolidayPopup()" style="display: block; margin: 20px auto;">Holiday Calendar</button>
            <button class="holiday-button" onclick="openHistoryPopup()" style="display: block; margin: 20px auto;">History</button>
        </div>
    </div>

    <!-- Holiday Popup -->
    <div id="holidayPopup" class="popup">
        <div class="popup-content">
            <span class="close" onclick="closeHolidayPopup()">&times;</span>
            <h2>Holiday Calendar</h2>
            <table border="0" style="border-collapse: collapse; width: 100%; height: auto;">
                <thead>
                    <tr>
                        <th style="width: 30%;" class="wThStyle">Date</th>
                        <th style="width: 70%; text-align: left;" class="wThStyle">Description</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td class="wTdStyle">2025-12-31</td>
                        <td class="wTdStyle" style="text-align: left;">New Year's Eve</td>
                    </tr>
                    <tr>
                        <td class="wTdStyle">2025-12-10</td>
                        <td class="wTdStyle" style="text-align: left;">Constitution Day</td>
                    </tr>
                    <tr>
                        <td class="wTdStyle">2025-12-05</td>
                        <td class="wTdStyle" style="text-align: left;">H.M. King Bhumibol Adulyadej The Great's Birthday / National Day / Father's Day</td>
                    </tr>
                    <tr>
                        <td class="wTdStyle">2025-10-23</td>
                        <td class="wTdStyle" style="text-align: left;">H.M. King Chulalongkorn The Great Memorial Day</td>
                    </tr>
                    <tr>
                        <td class="wTdStyle">2025-10-13</td>
                        <td class="wTdStyle" style="text-align: left;">H.M. King Bhumibol Adulyadej The Great Memorial Day</td>
                    </tr>
                    <tr>
                        <td class="wTdStyle">2025-08-12</td>
                        <td class="wTdStyle" style="text-align: left;">H.M. Queen Sirikit The Queen Mother's Birthday / Mother's Day</td>
                    </tr>
                    <tr>
                        <td class="wTdStyle">2025-08-11</td>
                        <td class="wTdStyle" style="text-align: left;">Additional special holiday (added)</td>
                    </tr>
                    <tr>
                        <td class="wTdStyle">2025-07-28</td>
                        <td class="wTdStyle" style="text-align: left;">H.M. King Maha Vajiralongkorn Phra Vajiraklaochaoyuhua's Birthday</td>
                    </tr>
                    <tr>
                        <td class="wTdStyle">2025-07-10</td>
                        <td class="wTdStyle" style="text-align: left;">Asarnha Bucha Day</td>
                    </tr>
                    <tr>
                        <td class="wTdStyle">2025-06-03</td>
                        <td class="wTdStyle" style="text-align: left;">H.M. Queen Suthida Bajrasudhabimalalakshana's Birthday</td>
                    </tr>
                    <tr>
                        <td class="wTdStyle">2025-06-02</td>
                        <td class="wTdStyle" style="text-align: left;">Additional special holiday (added)</td>
                    </tr>
                    <tr>
                        <td class="wTdStyle">2025-05-12</td>
                        <td class="wTdStyle" style="text-align: left;">Substitution for Visakha Bucha Day (Sunday 11 May 2025)</td>
                    </tr>
                    <tr>
                        <td class="wTdStyle">2025-05-05</td>
                        <td class="wTdStyle" style="text-align: left;">Substitution for Coronation Day (Sunday 4 May 2025)</td>
                    </tr>
                    <tr>
                        <td class="wTdStyle">2025-05-01</td>
                        <td class="wTdStyle" style="text-align: left;">National Labour Day</td>
                    </tr>
                    <tr>
                        <td class="wTdStyle">2025-04-15</td>
                        <td class="wTdStyle" style="text-align: left;">Songkran Festival</td>
                    </tr>
                    <tr>
                        <td class="wTdStyle">2025-04-14</td>
                        <td class="wTdStyle" style="text-align: left;">Songkran Festival</td>
                    </tr>
                    <tr>
                        <td class="wTdStyle">2025-04-07</td>
                        <td class="wTdStyle" style="text-align: left;">Substitution for Chakri Memorial Day (Sunday 6 April 2025)</td>
                    </tr>
                    <tr>
                        <td class="wTdStyle">2025-02-12</td>
                        <td class="wTdStyle" style="text-align: left;">Makha Bucha Day</td>
                    </tr>
                    <tr>
                        <td class="wTdStyle">2025-01-01</td>
                        <td class="wTdStyle" style="text-align: left;">New Year's Day</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- History Popup -->
    <div id="historyPopup" class="popup">
        <div class="popup-content">
            <span class="close" onclick="closeHistoryPopup()">&times;</span>
            <h2>History Data</h2>
            <div id="historyContent"></div>
        </div>
    </div>

    <script>
        // Market hours configuration
        const marketHours = {
            morning: { start: 9.5, end: 12.0167 }, // 9:30 AM to 12:01 PM
            afternoon: { start: 14, end: 16.5 } // 2:00 PM to 4:30 PM
        };
        
        // Holiday dates (YYYY-MM-DD format)
        const holidays = [
            '2025-12-31', '2025-12-10', '2025-12-05', '2025-10-23', '2025-10-13',
            '2025-08-12', '2025-08-11', '2025-07-28', '2025-07-10', '2025-06-03',
            '2025-06-02', '2025-05-12', '2025-05-05', '2025-05-01', '2025-04-15',
            '2025-04-14', '2025-04-07', '2025-02-12', '2025-01-01'
        ];
        
        // DOM Elements
        const marketStatusEl = document.getElementById('marketStatus');
        const topNumberEl = document.getElementById('topNumber');
        const timestampEl = document.getElementById('timestamp');
        const setDataEl = document.getElementById('setData');
        const valueDataEl = document.getElementById('valueData');
        const setFixData1El = document.getElementById('setFixData1');
        const valueFixData1El = document.getElementById('valueFixData1');
        const twodFixData1El = document.getElementById('twodFixData1');
        const setFixData2El = document.getElementById('setFixData2');
        const valueFixData2El = document.getElementById('valueFixData2');
        const twodFixData2El = document.getElementById('twodFixData2');
        const modernData1El = document.getElementById('modernData1');
        const internetData1El = document.getElementById('internetData1');
        const modernData2El = document.getElementById('modernData2');
        const internetData2El = document.getElementById('internetData2');
        const holidayPopupEl = document.getElementById('holidayPopup');
        const historyPopupEl = document.getElementById('historyPopup');
        const historyContentEl = document.getElementById('historyContent');
        
        // Popup functions
        function openHolidayPopup() {
            holidayPopupEl.style.display = 'block';
        }
        
        function closeHolidayPopup() {
            holidayPopupEl.style.display = 'none';
        }
        
        function openHistoryPopup() {
            historyPopupEl.style.display = 'block';
            displayHistoryData();
        }
        
        function closeHistoryPopup() {
            historyPopupEl.style.display = 'none';
        }
        
        // Close popup when clicking outside
        window.onclick = function(event) {
            if (event.target == holidayPopupEl) {
                holidayPopupEl.style.display = 'none';
            }
            if (event.target == historyPopupEl) {
                historyPopupEl.style.display = 'none';
            }
        }
        
        // Check if today is a weekend
        function isWeekend(date) {
            const day = date.getDay();
            return day === 0 || day === 6; // Sunday = 0, Saturday = 6
        }
        
        // Check if today is a holiday
        function isHoliday(date) {
            const dateString = date.toISOString().split('T')[0];
            return holidays.includes(dateString);
        }
        
        // Track if reset has been performed today
        let resetPerformedToday = false;
        
        // Check if it's 7:00 AM on a weekday and reset hasn't been performed yet
        function isResetTime(date) {
            const hours = date.getHours();
            const minutes = date.getMinutes();
            const day = date.getDay();
            
            // Check if it's 7:00 AM, a weekday (Monday-Friday), and reset hasn't been done today
            if (hours === 7 && minutes === 0 && day >= 1 && day <= 5 && !resetPerformedToday) {
                resetPerformedToday = true;
                return true;
            }
            
            // Reset the flag at 7:01 AM so it can trigger again tomorrow
            if (hours === 7 && minutes === 1) {
                resetPerformedToday = false;
            }
            
            return false;
        }
        
        // Reset all display data to "--"
        function resetDisplayData() {
            // Reset main display data
            setDataEl.textContent = "--";
            valueDataEl.textContent = "--";
            
            // Reset top number
            topNumberEl.textContent = "--";
            
            // Reset timeslot cards
            setFixData1El.textContent = "--";
            valueFixData1El.textContent = "--";
            twodFixData1El.textContent = "--";
            setFixData2El.textContent = "--";
            valueFixData2El.textContent = "--";
            twodFixData2El.textContent = "--";
            
            // Update timestamp
            const formattedDate = formatDate(new Date());
            timestampEl.textContent = `${formattedDate} at 07:00:00 --`;
        }
        
        // Get current time in decimal hours (e.g., 9.5 for 9:30 AM)
        function getCurrentTimeDecimal(date) {
            const hours = date.getHours();
            const minutes = date.getMinutes();
            return hours + minutes / 60;
        }
        
        // Get market status based on current time
        function getMarketStatus(date) {
            // Check if it's weekend or holiday
            if (isWeekend(date) || isHoliday(date)) {
                return 'closed';
            }
            
            const currentTime = getCurrentTimeDecimal(date);
            
            // Morning session: 9:30 AM to 12:01 PM
            if (currentTime >= marketHours.morning.start && currentTime < marketHours.morning.end) {
                return 'open';
            }
            
            // Break time: 12:01 PM to 2:00 PM
            if (currentTime >= marketHours.morning.end && currentTime < marketHours.afternoon.start) {
                return 'break';
            }
            
            // Afternoon session: 2:00 PM to 4:30 PM
            if (currentTime >= marketHours.afternoon.start && currentTime < marketHours.afternoon.end) {
                return 'open';
            }
            
            // Closed: 4:30 PM to 9:30 AM next day
            return 'closed';
        }
        
        // Update market status display
        function updateMarketStatus(status) {
            marketStatusEl.className = 'market-status';
            
            switch (status) {
                case 'open':
                    marketStatusEl.classList.add('open');
                    marketStatusEl.textContent = 'Market Status: OPEN';
                    break;
                case 'break':
                    marketStatusEl.classList.add('break');
                    marketStatusEl.textContent = 'Market Status: BREAK';
                    break;
                case 'closed':
                    marketStatusEl.classList.add('closed');
                    marketStatusEl.textContent = 'Market Status: CLOSED';
                    break;
                default:
                    marketStatusEl.textContent = 'Market Status: UNKNOWN';
            }
        }
        
        // Extract digits for top number
        function updateTopNumber(setData, valueData) {
            // Get last digit after decimal from setData
            const setDataText = setData.replace(/,/g, ''); // Remove commas
            const setDataParts = setDataText.split('.');
            const lastDigit = setDataParts.length > 1 ? setDataParts[1].slice(-1) : '0';
            
            // Get digit before decimal from valueData
            const valueDataText = valueData.replace(/,/g, ''); // Remove commas
            const valueDataParts = valueDataText.split('.');
            const beforeDecimal = valueDataParts[0];
            const secondDigit = beforeDecimal.charAt(beforeDecimal.length - 1);
            
            topNumberEl.textContent = lastDigit + secondDigit;
        }
        
        // Check if it's time to show "--" before capture for 12:01 PM card
        function isBefore1201Capture(date) {
            const hours = date.getHours();
            const minutes = date.getMinutes();
            
            // Before 12:01 PM (from market open at 9:30 AM until just before 12:01 PM)
            const currentTime = getCurrentTimeDecimal(date);
            const captureTime = 12.0167; // 12:01 PM
            
            return currentTime >= marketHours.morning.start && currentTime < captureTime;
        }
        
        // Check if it's time to show "--" before capture for 4:30 PM card
        function isBefore1630Capture(date) {
            const hours = date.getHours();
            const minutes = date.getMinutes();
            
            // Before 4:30 PM (from market open at 9:30 AM until just before 4:30 PM)
            const currentTime = getCurrentTimeDecimal(date);
            const captureTime = 16.5; // 4:30 PM
            
            // Show "--" from market open (9:30 AM) until 4:30 PM capture time
            return currentTime >= marketHours.morning.start && currentTime < captureTime;
        }
        
        // Check if it's time to fetch data for Modern Internet cards
        function shouldFetchModernData(date) {
            const currentTime = getCurrentTimeDecimal(date);
            
            // Fetch data during market hours:
            // 1. 9:30 AM to 12:01 PM for first card
            // 2. 2:00 PM to 4:30 PM for second card
            // 3. After 8:00 PM (static until restart)
            const isFirstSession = currentTime >= marketHours.morning.start && currentTime < marketHours.morning.end;
            const isSecondSession = currentTime >= marketHours.afternoon.start && currentTime < marketHours.afternoon.end;
            const isAfterEightPM = currentTime >= 20; // 8:00 PM
            
            return isFirstSession || isSecondSession || isAfterEightPM;
        }
        
        // Fetch real data for Modern Internet cards from mylucky2d3d.com
        function fetchModernData() {
            const now = new Date();
            const currentTime = getCurrentTimeDecimal(now);
            
            // For first card (9:30 AM - 12:01 PM)
            if (currentTime >= marketHours.morning.start && currentTime < marketHours.morning.end) {
                fetchModernInternetData(1);
            }
            
            // For second card (2:00 PM - 4:30 PM)
            if (currentTime >= marketHours.afternoon.start && currentTime < marketHours.afternoon.end) {
                fetchModernInternetData(2);
            }
        }
        
        // Fetch Modern Internet data - fetches from generated data file
        function fetchModernInternetData(cardNumber) {
            // Fetch from the data file generated by the backend script
            fetch('data/modern-internet-data.json')
                .then(response => response.json())
                .then(data => {
                    if (cardNumber === 1) {
                        // Find the 9:30 AM card data
                        const cardData = data.cards.find(card => card.time === '9:30 AM');
                        if (cardData) {
                            // Check if data is available or show "--"
                            modernData1El.textContent = cardData.modern;
                            internetData1El.textContent = cardData.internet;
                        }
                    } else if (cardNumber === 2) {
                        // Find the 2:00 PM card data
                        const cardData = data.cards.find(card => card.time === '2:00 PM');
                        if (cardData) {
                            // Check if data is available or show "--"
                            modernData2El.textContent = cardData.modern;
                            internetData2El.textContent = cardData.internet;
                        }
                    }
                })
                .catch(error => {
                    console.error('Error fetching Modern Internet data:', error);
                    // Show "--" on error
                    if (cardNumber === 1) {
                        modernData1El.textContent = "--";
                        internetData1El.textContent = "--";
                    } else if (cardNumber === 2) {
                        modernData2El.textContent = "--";
                        internetData2El.textContent = "--";
                    }
                });
        }

        // Update display based on market status
        function updateDisplayData(status) {
            const now = new Date();
            
            if (status === 'open') {
                // During market open, show live data (simulated)
                const simulatedSetData = "1,291.46";
                const simulatedValueData = "33,202.91";
                
                setDataEl.textContent = simulatedSetData;
                valueDataEl.textContent = simulatedValueData;
                
                // Update top number with live data
                updateTopNumber(simulatedSetData, simulatedValueData);
                
                // Update timestamp with current time
                const formattedDate = formatDate(now);
                const formattedTime = formatTime(now);
                timestampEl.textContent = `${formattedDate} at ${formattedTime}`;
                
                // Handle timeslot cards before capture time
                if (isBefore1201Capture(now)) {
                    // Show "--" in 12:01 PM card before capture
                    setFixData1El.textContent = "--";
                    valueFixData1El.textContent = "--";
                    twodFixData1El.textContent = "--";
                } else {
                    // Show normal data in 12:01 PM card
                    setFixData1El.textContent = "1,261.23";
                    valueFixData1El.textContent = "13,522.14";
                    twodFixData1El.textContent = "32";
                }
                
                if (isBefore1630Capture(now)) {
                    // Show "--" in 4:30 PM card before capture
                    setFixData2El.textContent = "--";
                    valueFixData2El.textContent = "--";
                    twodFixData2El.textContent = "--";
                } else {
                    // Show normal data in 4:30 PM card
                    setFixData2El.textContent = "1,252.71";
                    valueFixData2El.textContent = "23,180.98";
                    twodFixData2El.textContent = "10";
                }
                
                // Fetch data for Modern Internet cards during market hours or after 8:00 PM
                if (shouldFetchModernData(now)) {
                    fetchModernData();
                }
            } else if (status === 'break') {
                // During market break, show data from 12:01PM timeslot card
                const breakSetData = setFixData1El.textContent;
                const breakValueData = valueFixData1El.textContent;
                
                setDataEl.textContent = breakSetData;
                valueDataEl.textContent = breakValueData;
                
                // Update top number with break data
                updateTopNumber(breakSetData, breakValueData);
                
                // Update timestamp with break time (12:01:00 PM)
                const formattedDate = formatDate(now);
                timestampEl.textContent = `${formattedDate} at 12:01:00`;
            } else if (status === 'closed') {
                // During market closed, show data from 4:30PM timeslot card
                const closedSetData = setFixData2El.textContent;
                const closedValueData = valueFixData2El.textContent;
                
                setDataEl.textContent = closedSetData;
                valueDataEl.textContent = closedValueData;
                
                // Update top number with closed data
                updateTopNumber(closedSetData, closedValueData);
                
                // Update timestamp with closed time (4:30:00 PM)
                const formattedDate = formatDate(now);
                timestampEl.textContent = `${formattedDate} at 16:30:00`;
            }
        }
        
        // Format date as dd/mm/yyyy
        function formatDate(date) {
            const day = String(date.getDate()).padStart(2, '0');
            const month = String(date.getMonth() + 1).padStart(2, '0'); // Months are zero-indexed
            const year = date.getFullYear();
            return `${day}/${month}/${year}`;
        }
        
        // Format time as hh:mm:ss
        function formatTime(date) {
            const hours = String(date.getHours()).padStart(2, '0');
            const minutes = String(date.getMinutes()).padStart(2, '0');
            const seconds = String(date.getSeconds()).padStart(2, '0');
            return `${hours}:${minutes}:${seconds}`;
        }
        
        // History data storage
        let historyData = JSON.parse(localStorage.getItem('marketHistoryData')) || {};
        
        // If no history data exists, initialize with sample data
        if (Object.keys(historyData).length === 0) {
            initializeSampleHistoryData();
        }
        
        // Initialize with sample history data for demonstration
        function initializeSampleHistoryData() {
            const today = new Date();
            const todayFormatted = formatDate(today);
            
            historyData = {
                [todayFormatted]: {
                    date: todayFormatted,
                    dayName: getDayName(today.getDay()),
                    entries: [{
                        time: "20:00:00",
                        set1201: "1,261.23",
                        value1201: "13,522.14",
                        lucky1201: "32",
                        set1630: "1,252.71",
                        value1630: "23,180.98",
                        lucky1630: "10"
                    }]
                }
            };
            
            // Save sample data to localStorage
            localStorage.setItem('marketHistoryData', JSON.stringify(historyData));
        }
        
        // Schedule daily data storage at 8:00 PM
        function scheduleDailyStorage() {
            const now = new Date();
            const targetTime = new Date();
            targetTime.setHours(20, 0, 0, 0); // 8:00 PM
            
            // If it's already past 8:00 PM today, schedule for tomorrow
            if (now > targetTime) {
                targetTime.setDate(targetTime.getDate() + 1);
            }
            
            const timeUntilTarget = targetTime.getTime() - now.getTime();
            
            // Schedule the data storage
            setTimeout(() => {
                saveDailyDataToHistory();
                // Schedule next day's storage
                scheduleDailyStorage();
            }, timeUntilTarget);
        }
        
        // Filter history data to keep only entries stored at 8:00 PM
        function filterHistoryData() {
            // Iterate through each date in historyData
            for (const dateKey in historyData) {
                if (historyData.hasOwnProperty(dateKey)) {
                    const dateData = historyData[dateKey];
                    
                    // Filter entries to keep only those with time "20:00:00"
                    dateData.entries = dateData.entries.filter(entry => entry.time === "20:00:00");
                    
                    // If no entries left for this date, remove the date entirely
                    if (dateData.entries.length === 0) {
                        delete historyData[dateKey];
                    }
                }
            }
            
            // Save the filtered data back to localStorage
            localStorage.setItem('marketHistoryData', JSON.stringify(historyData));
        }
        
        // Save daily data to history at 8:00 PM
        function saveDailyDataToHistory() {
            const now = new Date();
            const dayOfWeek = now.getDay(); // 0 = Sunday, 1 = Monday, ..., 6 = Saturday
            
            // Only save data on weekdays (Monday to Friday)
            if (dayOfWeek >= 1 && dayOfWeek <= 5) {
                const dateKey = formatDate(now);
                const currentTime = "20:00:00"; // 8:00 PM
                
                // Check if we need to reset history for a new week
                if (shouldResetHistory(now)) {
                    historyData = {};
                }
                
                // Save data for current day
                if (!historyData[dateKey]) {
                    historyData[dateKey] = {
                        date: dateKey,
                        dayName: getDayName(dayOfWeek),
                        entries: []
                    };
                }
                
                // Check if today is a holiday
                const isTodayHoliday = isHoliday(now);
                
                // Add daily data entry at 8:00 PM
                historyData[dateKey].entries.push({
                    time: currentTime,
                    set1201: isTodayHoliday ? "OFF" : setFixData1El.textContent,
                    value1201: isTodayHoliday ? "OFF" : valueFixData1El.textContent,
                    lucky1201: isTodayHoliday ? "OFF" : twodFixData1El.textContent,
                    set1630: isTodayHoliday ? "OFF" : setFixData2El.textContent,
                    value1630: isTodayHoliday ? "OFF" : valueFixData2El.textContent,
                    lucky1630: isTodayHoliday ? "OFF" : twodFixData2El.textContent
                });
                
                // Keep only last 5 entries per day to avoid excessive data
                if (historyData[dateKey].entries.length > 5) {
                    historyData[dateKey].entries.shift();
                }
                
                // Save to localStorage
                localStorage.setItem('marketHistoryData', JSON.stringify(historyData));
                
                // Filter history data to keep only 8:00 PM entries
                filterHistoryData();
            }
        }
        
        // Save current data to history (for manual updates)
        function saveToHistory() {
            const now = new Date();
            const dayOfWeek = now.getDay(); // 0 = Sunday, 1 = Monday, ..., 6 = Saturday
            
            // Only save data on weekdays (Monday to Friday)
            if (dayOfWeek >= 1 && dayOfWeek <= 5) {
                const dateKey = formatDate(now);
                const currentTime = formatTime(now);
                
                // Check if we need to reset history for a new week
                if (shouldResetHistory(now)) {
                    historyData = {};
                }
                
                // Save data for current day
                if (!historyData[dateKey]) {
                    historyData[dateKey] = {
                        date: dateKey,
                        dayName: getDayName(dayOfWeek),
                        entries: []
                    };
                }
                
                // Check if today is a holiday
                const isTodayHoliday = isHoliday(now);
                
                // Add current data entry
                historyData[dateKey].entries.push({
                    time: currentTime,
                    set1201: isTodayHoliday ? "OFF" : setFixData1El.textContent,
                    value1201: isTodayHoliday ? "OFF" : valueFixData1El.textContent,
                    lucky1201: isTodayHoliday ? "OFF" : twodFixData1El.textContent,
                    set1630: isTodayHoliday ? "OFF" : setFixData2El.textContent,
                    value1630: isTodayHoliday ? "OFF" : valueFixData2El.textContent,
                    lucky1630: isTodayHoliday ? "OFF" : twodFixData2El.textContent
                });
                
                // Keep only last 5 entries per day to avoid excessive data
                if (historyData[dateKey].entries.length > 5) {
                    historyData[dateKey].entries.shift();
                }
                
                // Save to localStorage
                localStorage.setItem('marketHistoryData', JSON.stringify(historyData));
                
                // Filter history data to keep only 8:00 PM entries
                filterHistoryData();
            }
        }
        
        // Check if we should reset history for a new week
        function shouldResetHistory(currentDate) {
            // If history is empty, don't reset
            if (Object.keys(historyData).length === 0) return false;
            
            // Get the earliest date in history
            const dates = Object.keys(historyData).map(dateStr => {
                const parts = dateStr.split('/');
                return new Date(parts[2], parts[1] - 1, parts[0]); // yyyy, mm, dd
            });
            
            const earliestDate = new Date(Math.min(...dates));
            
            // Check if current date is in a new week compared to earliest date
            const earliestWeek = getWeekNumber(earliestDate);
            const currentWeek = getWeekNumber(currentDate);
            
            return currentWeek > earliestWeek;
        }
        
        // Get week number of a date
        function getWeekNumber(date) {
            const firstDayOfYear = new Date(date.getFullYear(), 0, 1);
            const pastDaysOfYear = (date - firstDayOfYear) / 86400000;
            return Math.ceil((pastDaysOfYear + firstDayOfYear.getDay() + 1) / 7);
        }
        
        // Get day name from day of week number
        function getDayName(dayOfWeek) {
            const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
            return days[dayOfWeek];
        }
        
        // Display history data in popup
        function displayHistoryData() {
            if (Object.keys(historyData).length === 0) {
                historyContentEl.innerHTML = '<p>No history data available.</p>';
                return;
            }
            
            let html = '<div style="max-height: 500px; overflow-y: auto;">';
            
            // Sort dates
            const sortedDates = Object.keys(historyData).sort((a, b) => {
                const [dayA, monthA, yearA] = a.split('/');
                const [dayB, monthB, yearB] = b.split('/');
                const dateA = new Date(yearA, monthA - 1, dayA);
                const dateB = new Date(yearB, monthB - 1, dayB);
                return dateB - dateA;
            });
            
            // Display data for each date
            sortedDates.forEach(dateKey => {
                const dayData = historyData[dateKey];
                html += `<h3>${dayData.dayName}, ${dateKey}</h3>`;
                html += '<table border="1" style="width: 100%; border-collapse: collapse; margin-bottom: 20px;">';
                html += '<thead><tr>';
                html += '<th>Time</th>';
                html += '<th>12:01 PM SET</th>';
                html += '<th>12:01 PM VALUE</th>';
                html += '<th>12:01 PM 2D</th>';
                html += '<th>4:30 PM SET</th>';
                html += '<th>4:30 PM VALUE</th>';
                html += '<th>4:30 PM 2D</th>';
                html += '</tr></thead><tbody>';
                
                dayData.entries.forEach(entry => {
                    html += '<tr>';
                    html += `<td>${entry.time}</td>`;
                    html += `<td>${entry.set1201}</td>`;
                    html += `<td>${entry.value1201}</td>`;
                    html += `<td>${entry.lucky1201}</td>`;
                    html += `<td>${entry.set1630}</td>`;
                    html += `<td>${entry.value1630}</td>`;
                    html += `<td>${entry.lucky1630}</td>`;
                    html += '</tr>';
                });
                
                html += '</tbody></table>';
            });
            
            html += '</div>';
            historyContentEl.innerHTML = html;
        }
        
        // Simulate data fetching (in a real app, this would fetch from APIs)
        function fetchData() {
            const now = new Date();
            
            // Simulated data - in a real implementation, you would fetch this from the actual sources
            const simulatedSetData = "1,291.46";
            const simulatedValueData = "33,202.91";
            
            // Update the data elements
            setDataEl.textContent = simulatedSetData;
            valueDataEl.textContent = simulatedValueData;
            
            // Update top number
            updateTopNumber(simulatedSetData, simulatedValueData);
            
            // Handle timeslot cards before capture time
            if (isBefore1201Capture(now)) {
                // Show "--" in 12:01 PM card before capture
                setFixData1El.textContent = "--";
                valueFixData1El.textContent = "--";
                twodFixData1El.textContent = "--";
            } else {
                // Update 12:01 PM timeslot data
                const amSetData = "1,261.23";
                const amValueData = "13,522.14";
                const amLuckyData = "32";
                
                setFixData1El.textContent = amSetData;
                valueFixData1El.textContent = amValueData;
                twodFixData1El.textContent = amLuckyData;
            }
            
            if (isBefore1630Capture(now)) {
                // Show "--" in 4:30 PM card before capture
                setFixData2El.textContent = "--";
                valueFixData2El.textContent = "--";
                twodFixData2El.textContent = "--";
            } else {
                // Update 4:30 PM timeslot data
                const pmSetData = "1,252.71";
                const pmValueData = "23,180.98";
                const pmLuckyData = "10";
                
                setFixData2El.textContent = pmSetData;
                valueFixData2El.textContent = pmValueData;
                twodFixData2El.textContent = pmLuckyData;
            }
            
            // Fetch data for Modern Internet cards during market hours or after 8:00 PM
            if (shouldFetchModernData(now)) {
                fetchModernData();
            }
            
            // Save data to history
            saveToHistory();
        }
        
        // Handle data fading effect
        function fadeData() {
            const status = getMarketStatus(new Date());
            
            if (status === 'open') {
                // Add fade-out class
                setDataEl.classList.add('fade-out');
                valueDataEl.classList.add('fade-out');
                
                // After fade-out, update data and fade back in
                setTimeout(() => {
                    fetchData();
                    setDataEl.classList.remove('fade-out');
                    valueDataEl.classList.remove('fade-out');
                    setDataEl.classList.add('fade-in');
                    valueDataEl.classList.add('fade-in');
                    
                    // Remove fade-in class after animation completes
                    setTimeout(() => {
                        setDataEl.classList.remove('fade-in');
                        valueDataEl.classList.remove('fade-in');
                    }, 500);
                }, 500);
            }
        }
        
        // Main update function
        function updateDisplay() {
            const now = new Date();
            const status = getMarketStatus(now);
            
            // Check if it's reset time (7:00 AM on weekdays)
            if (isResetTime(now)) {
                resetDisplayData();
                return; // Skip normal update logic
            }
            
            // Update market status display
            updateMarketStatus(status);
            
            // Update data display based on market status
            updateDisplayData(status);
            
            // Handle data updates based on market status
            if (status === 'open') {
                // Update data immediately and then every 5 seconds
                fetchData();
            }
        }
        
        // Initialize the dashboard
        function initDashboard() {
            // Filter existing history data to keep only 8:00 PM entries
            filterHistoryData();
            
            // Initial update
            updateDisplay();
            
            // Schedule daily data storage at 8:00 PM
            scheduleDailyStorage();
            
            // Update every second to check market status changes and reset time
            setInterval(updateDisplay, 1000);
            
            // Update data every 5 seconds during open hours
            setInterval(() => {
                const status = getMarketStatus(new Date());
                if (status === 'open') {
                    fadeData();
                }
            }, 5000);
        }
        
        // Start the dashboard when page loads
        window.onload = initDashboard;
    </script>
</body>
</html>
